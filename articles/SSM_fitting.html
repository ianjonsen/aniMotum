<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SSM_fitting • aniMotum</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SSM_fitting">
<meta property="og:description" content="aniMotum">
<meta property="og:image" content="https://ianjonsen.github.io/aniMotum/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">aniMotum</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1-04</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/SSM_fitting.html">SSM_fitting</a>
    </li>
    <li>
      <a href="../articles/SSM_validation.html">SSM_validation</a>
    </li>
    <li>
      <a href="../articles/Move_persistence_models.html">Move_persistence_models</a>
    </li>
    <li>
      <a href="../articles/Track_simulation.html">Track_simulation</a>
    </li>
    <li>
      <a href="../articles/Mapping.html">Mapping</a>
    </li>
    <li>
      <a href="../articles/Path_rerouting.html">Path_rerouting</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/ianjonsen/aniMotum" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SSM_fitting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ianjonsen/aniMotum/blob/HEAD/vignettes/SSM_fitting.Rmd" class="external-link"><code>vignettes/SSM_fitting.Rmd</code></a></small>
      <div class="hidden name"><code>SSM_fitting.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="processing-data">Processing data<a class="anchor" aria-label="anchor" href="#processing-data"></a>
</h3>
<p>Fitting SSM’s to tracking data in <code>aniMotum</code> is intended
to be as simple as possible using <code><a href="../reference/fit_ssm.html">fit_ssm()</a></code>. Provided the
data are in an expected format (see <code><a href="../articles/Overview.html">vignette('Overview')</a></code>),
<code>fit_ssm</code> can be invoked immediately to both process the data
and fit the SSM. Within <code>fit_ssm</code>, data processing consists
of:</p>
<ol style="list-style-type: decimal">
<li>identifying the most appropriate measurement error model to use
based on the format of the data;<br>
</li>
<li>date formatting, ordering observations in time, flagging duplicate
date-time observations, flagging observations occurring within a minimum
time period (default = 60 s);<br>
</li>
<li>projecting long,lat coordinates to Mercator x,y (in km) accounting
for -180,180 crossing;<br>
</li>
<li>using <a href="https://CRAN.R-project.org/package=trip" class="external-link"><code>trip::sda</code></a>
to identify potentially extreme observations based on speed, distance,
and angle (Freitas et al. 2008).</li>
</ol>
<p>Several arguments to <code>fit_ssm</code> provide a measure of
control over data processing. The <code>vmax</code>, <code>ang</code>
and <code>distlim</code> arguments provide control over the
<code>trip::sda</code> filter (see <code><a href="../reference/fit_ssm.html">?fit_ssm</a></code> for details).
The <code>sda</code> filter can occasionally fail (possibly when
calculating angles between successive displacements), in this case we
fall back to using <code>trip::speedfilter</code> and a warning issued.
The <code>trip</code> filter can be turned off altogether with
<code>spdf = FALSE</code>, although this is usually not advisable if
working with older Least-Squares Argos data, the lower prevalence of
extreme observations in newer Kalman filtered Argos data may not always
require speed-filtering prior to fitting an SSM. The minimum time
interval allowed between observations is set by <code>min.dt</code>.
Finally, the processed data can be returned, e.g. for careful
inspection, without fitting an SSM with the <code>pf = TRUE</code>
argument:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>        vmax <span class="op">=</span> <span class="fl">3</span>, </span>
<span>        pf <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 64 features and 12 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 7832.966 ymin: -9972.317 xmax: 12324.95 ymax: -6302.65</span></span>
<span><span class="co">#&gt; CRS:           +proj=merc +lon_0=0 +datum=WGS84 +units=km +no_defs</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;             id                date lc   smaj  smin       eor lonerr laterr</span></span>
<span><span class="co">#&gt; 54591.1  54591 2012-03-05 05:09:33  1  2.442 0.416 0.7330383     NA     NA</span></span>
<span><span class="co">#&gt; 54591.4  54591 2012-03-06 04:55:14  0 49.660 0.391 1.5707963     NA     NA</span></span>
<span><span class="co">#&gt; 54591.20 54591 2012-03-07 04:23:10  A  5.032 0.472 1.6231562     NA     NA</span></span>
<span><span class="co">#&gt; 54591.25 54591 2012-03-07 21:23:06  A  4.007 0.286 2.0245819     NA     NA</span></span>
<span><span class="co">#&gt; 54591.43 54591 2012-03-09 04:27:49  B 13.063 0.956 1.4311700     NA     NA</span></span>
<span><span class="co">#&gt; 54591.15 54591 2012-03-10 00:10:41  A  5.099 0.478 1.3788101     NA     NA</span></span>
<span><span class="co">#&gt; 54591.46 54591 2012-03-10 23:56:13  B  1.844 0.224 1.5882496     NA     NA</span></span>
<span><span class="co">#&gt; 54591.12 54591 2012-03-12 03:05:37  0 47.107 0.716 1.7976891     NA     NA</span></span>
<span><span class="co">#&gt; 54591.27 54591 2012-03-13 13:16:58  A  0.596 0.218 2.2165682     NA     NA</span></span>
<span><span class="co">#&gt; 54591.18 54591 2012-03-14 13:11:48  A  4.489 2.754 2.0245819     NA     NA</span></span>
<span><span class="co">#&gt;           keep obs.type emf.x emf.y                   geometry</span></span>
<span><span class="co">#&gt; 54591.1   TRUE       KF    NA    NA POINT (12308.67 -9955.638)</span></span>
<span><span class="co">#&gt; 54591.4   TRUE       KF    NA    NA POINT (12283.02 -9946.821)</span></span>
<span><span class="co">#&gt; 54591.20 FALSE       KF    NA    NA POINT (12298.33 -9962.632)</span></span>
<span><span class="co">#&gt; 54591.25 FALSE       KF    NA    NA  POINT (12286.88 -9946.94)</span></span>
<span><span class="co">#&gt; 54591.43  TRUE       KF    NA    NA POINT (12297.82 -9972.317)</span></span>
<span><span class="co">#&gt; 54591.15  TRUE       KF    NA    NA POINT (12300.96 -9957.763)</span></span>
<span><span class="co">#&gt; 54591.46 FALSE       KF    NA    NA POINT (12324.95 -9967.605)</span></span>
<span><span class="co">#&gt; 54591.12  TRUE       KF    NA    NA POINT (12273.21 -9959.318)</span></span>
<span><span class="co">#&gt; 54591.27  TRUE       KF    NA    NA POINT (12288.02 -9948.256)</span></span>
<span><span class="co">#&gt; 54591.18  TRUE       KF    NA    NA POINT (12292.13 -9935.724)</span></span></code></pre></div>
<p>By setting <code>pf = TRUE</code>, <code>fit_ssm</code> returns the
processed data as a projected <code>sf</code> data.frame prior to
fitting an SSM. Looking at the <code>keep</code> column, we can see that
the 3rd, 4th and 7th observations have been flagged to be ignored by the
SSM, in this case because they failed the distance limits imposed by the
<code>trip::sda</code> filter. Also note that because the data included
CLS Argos location ellipse error information, the observation type has
been designated <code>KF</code> for Kalman filter and this ensures that
the appropriate measurement error model is used when fitting the SSM to
these data.</p>
</div>
<div class="section level3">
<h3 id="fit-an-ssm">Fit an SSM<a class="anchor" aria-label="anchor" href="#fit-an-ssm"></a>
</h3>
<p>In the simplest case, fitting an SSM consists of specifying the
process model and a prediction time step:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>               model <span class="op">=</span> <span class="st">"rw"</span>, </span>
<span>               time.step <span class="op">=</span> <span class="fl">24</span><span class="op">)</span></span></code></pre></div>
<p>This call uses the defaults for data processing and all other
arguments (see <code><a href="../reference/fit_ssm.html">?fit_ssm</a></code> for details). More control can be
exerted over the model fitting process via the arguments:
<code>emf</code>, <code>map</code>, and <code>control</code>.</p>
<div class="section level4">
<h4 id="emf-specifying-error-multiplication-factors">
<code>emf</code>: specifying error multiplication factors<a class="anchor" aria-label="anchor" href="#emf-specifying-error-multiplication-factors"></a>
</h4>
<p>The <code>emf</code> argument is helpful when modelling older Argos
Least-Squares location data as it allows alternate specification of
error multiplication factors for each location quality class. The error
multiplication factors define the magnitude of the location error
standard deviation for each Argos location quality class relative to the
best quality class, 3. The emf’s used by default in
<code>aniMotum</code> (see Jonsen et al. 2020 for further details) are
unlikely to be equally applicable to all tracking data sets. Alternate
specifications could be derived from Argos location error studies that
draw on Argos - GPS double-tagging data such as (Costa et al. 2010).</p>
<p>The default emf values are given by <code><a href="../reference/emf.html">emf()</a></code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/emf.html">emf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   emf.x emf.y lc</span></span>
<span><span class="co">#&gt; 1  0.10  0.10  G</span></span>
<span><span class="co">#&gt; 2  1.00  1.00  3</span></span>
<span><span class="co">#&gt; 3  1.54  1.29  2</span></span>
<span><span class="co">#&gt; 4  3.72  2.55  1</span></span>
<span><span class="co">#&gt; 5 13.51 14.99  0</span></span>
<span><span class="co">#&gt; 6 23.90 22.00  A</span></span>
<span><span class="co">#&gt; 7 44.22 32.53  B</span></span>
<span><span class="co">#&gt; 8 44.22 32.53  Z</span></span></code></pre></div>
<p>These can be adjusted by modifying the data.frame and passing this to
<code>fit_ssm</code> via `emf.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">emf2</span> <span class="op">&lt;-</span> <span class="fu">mutate</span><span class="op">(</span><span class="fu"><a href="../reference/emf.html">emf</a></span><span class="op">(</span><span class="op">)</span>, emf.x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">20</span>, <span class="fl">8</span>, <span class="fl">15</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sese2</span>, <span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                model <span class="op">=</span> <span class="st">"rw"</span>, </span>
<span>                time.step<span class="op">=</span><span class="fl">24</span>, </span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">sese2</span>, <span class="va">id</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, </span>
<span>                model <span class="op">=</span> <span class="st">"rw"</span>, </span>
<span>                time.step<span class="op">=</span><span class="fl">24</span>, </span>
<span>                emf <span class="op">=</span> <span class="va">emf2</span>, </span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="../reference/grab.html">grab</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">$</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="../reference/grab.html">grab</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">$</span><span class="va">x</span>, breaks <span class="op">=</span> <span class="fl">20</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"fit1$x - fit2$x"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="fu"><a href="../reference/grab.html">grab</a></span><span class="op">(</span><span class="va">fit1</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="fu"><a href="../reference/grab.html">grab</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="st">"f"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span>, breaks <span class="op">=</span> <span class="fl">20</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"fit1$y - fit2$y"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Distance (km)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="SSM_fitting_files/figure-html/emf%20mod-1.png" width="672"></p>
<p>In this contrived example, re-specified <code>emf.x</code> values
result in differences in the predicted locations of up to about 20 km in
the x-direction and a more subtle 4 km in the y-direction, even though
the <code>emf.y</code> values were not edited. The latter is due to a
model-estimated correlation between the x and y errors.</p>
<p>Now that CLS Argos provides locations estimated by their Kalman
filter algorithm, users of contemporary Argos data sets should have no
need to invoke the <code>emf</code> argument as location quality
class-based errors are now superseded by the use of location-specific
Argos error ellipse information (McClintock et al. 2015; Jonsen et
al. 2020).</p>
</div>
<div class="section level4">
<h4 id="map-fixing-model-parameters">
<code>map</code>: fixing model parameters<a class="anchor" aria-label="anchor" href="#map-fixing-model-parameters"></a>
</h4>
<p>The <code>map</code> argument allows some model parameters to by
turned off by fixing them at 0 on the log-scale. This can be useful in
cases where model simplification can aid in convergence or simply
provide a better fit to the data. For example, the <code>crw</code> has
a parameter <code>psi</code> that re-scales the semi-major axis of Argos
KF error ellipses to account for apparent bias in the error ellipses
(Jonsen et al. 2020). Occasionally, there may be insufficient
information to reliably estimate this parameter, or one might wish to
compare model fits with and without error ellipse bias correction.</p>
<p>Here we fit the <code>crw</code> model with (<code>fit1</code>) and
without (<code>fit2</code>) the bias-correction parameter
<code>psi</code>, by supplying a named list to the <code>map</code>
argument. Where <code>factor(NA)</code> is a <code>TMB</code> convention
that ensures <code>psi</code> is fixed during optimization.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>                model <span class="op">=</span> <span class="st">"crw"</span>, </span>
<span>                time.step <span class="op">=</span> <span class="fl">24</span>,</span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>                model <span class="op">=</span> <span class="st">"crw"</span>, </span>
<span>                time.step <span class="op">=</span> <span class="fl">24</span>, </span>
<span>                map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>psi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">fit1</span><span class="op">$</span><span class="va">ssm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AICc</span>, <span class="va">fit2</span><span class="op">$</span><span class="va">ssm</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">AICc</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1289.387 1292.607</span></span></code></pre></div>
<p>Comparison of AIC<sub>c</sub> from the model fits implies the model
including the <code>psi</code> parameter <code>fit1</code> provides a
slightly better fit.</p>
</div>
<div class="section level4">
<h4 id="control-controlling-the-optimization">
<code>control</code>: controlling the optimization<a class="anchor" aria-label="anchor" href="#control-controlling-the-optimization"></a>
</h4>
<p>By default, <code>aniMotum</code> uses R’s <code>nlminb</code>
optimizer, but users can also select the more flexible
<code>optim</code> to minimize the objective function defined by the
built-in <code>TMB</code> C++ templates. Users can specify which
optimizer to use via the <code>control</code> argument, which takes a
named list as input that is provided by the utility function
`ssm_control:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>               model <span class="op">=</span> <span class="st">"crw"</span>, </span>
<span>               time.step <span class="op">=</span> <span class="fl">24</span>,</span>
<span>               control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>optim <span class="op">=</span> <span class="st">"optim"</span>,</span>
<span>                                     verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here, we use <code>control = ssm_control()</code> to set the
optimizer to <code>optim</code> and turned off the parameter trace that
would be printed to the console by default. See
<code><a href="../reference/ssm_control.html">?ssm_control</a></code> for further options. Both of optimizers rely
on a list of control parameters that allow fine-tuning of the
optimization process, which can aid convergence on tricky data sets.
Users can specify any of these control parameters in
<code>ssm_control</code>, for example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_ssm.html">fit_ssm</a></span><span class="op">(</span><span class="va">ellie</span>, </span>
<span>               model <span class="op">=</span> <span class="st">"crw"</span>, </span>
<span>               time.step <span class="op">=</span> <span class="fl">24</span>,</span>
<span>               control <span class="op">=</span> <span class="fu"><a href="../reference/ssm_control.html">ssm_control</a></span><span class="op">(</span>optim <span class="op">=</span> <span class="st">"optim"</span>,</span>
<span>                                     maxit <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     verbose <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we increase the maximum number of optimizer iterations from 100
(<code>optim</code> default for derivative-based methods) to 1000. Note,
users must know the correct name for each optimizer’s control arguments
and should be familiar with their effect on the optimization before
using, see <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">?nlminb</a></code> and <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">?optim</a></code> for details.</p>
<p>The <code>control</code> argument is used to turn off parameter trace
printing via <code>ssm_control(verbose = 0)</code> in all above
examples. This keeps the vignette tidy as the default parameter trace
would print as a long list to the vignette. In normal use in the
console, the parameter trace overwrites itself on a single line per
individual data set and is provided as a guide to model fitting
progress. The full inner and outer optimization as reported by
<code>TMB</code> (Kristensen et al. 2016) can also be printed to the
console by setting <code>ssm_control(verbose = 2)</code>; this can be
helpful in diagnosing convergence failures or optimization errors.</p>
<p>Finally, the <code>ssm_control(se = TRUE)</code> argument can be
invoked when fitting the <code>crw</code> SSM to turn on computation of
SE’s for speed-along-track estimates. By default, these SE’s are turned
off as their calculation require considerable computation, which
increases with the number of prediction intervals, and dramatically
increases the time required to fit the <code>crw</code> model.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Costa DP, Robinson PW, Arnould JPY, Harrison AL, Simmons SE, Hassrick
JL, Hoskins AJ, Kirkman SP, Oosthuizen H, Villegas-Amtmann S, Crocker DE
(2010) Accuracy of ARGOS locations of pinnipeds at-sea estimated using
Fastloc GPS. <em>PLOS One</em> 5:e8677.</p>
<p>Freitas C, Lydersen C, Fedak MA, Kovacs KM (2008) A simple new
algorithm to filter marine mammal Argos locations. <em>Marine Mammal
Science</em> 24: 315-325.</p>
<p>Jonsen ID, Patterson TA, Costa DP, Doherty PD, Godley BJ, Grecian WJ,
Guinet C, Hoenner X, Kienle SS, Robinson PW, Votier SC, Whiting S, Witt
MJ, Hindell MA, Harcourt RG, McMahon CR (2020) A continuous-time
state-space model for rapid quality control of Argos locations from
animal-borne tags. <em>Movement Ecology</em> 8:31.</p>
<p>Kristense K, Nielsen A, Berg CW, Skaug H, Bell BM (2016) TMB:
automatic differentiation and Laplace approximation. <em>Journal of
Statistical Software</em> 70:1-21.</p>
<p>McClintock BT, London JM, Cameron MF, Boveng PL (2015) Modelling
animal movement using the Argos satellite telemetry location error
ellipse. <em>Methods in Ecology and Evolution</em> 6:266–77.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ian Jonsen, W. James Grecian, Toby Patterson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
